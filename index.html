<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tools for contextualizing tests • covtracer</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Tools for contextualizing tests">
<meta property="og:description" content='
    Provides tools for dissecting a package namespace or "covr" coverage object
    in order to cross reference tested code with the lines that are evaluated, as
    well as linking those evaluated lines to the documentation that they are
    described within. Connecting these three pieces of information provides a
    mechanism of linking tests to documented behaviors.'>
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">covtracer</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/combining_srcref_data.html">Combining srcref Data</a>
    </li>
    <li>
      <a href="articles/working_with_srcrefs.html">Working with srcrefs</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="">
    <span class="fa fa-gitlab fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="coverage.html">
    <span class="fa fa-layer-group"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="covtracer" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#covtracer" class="anchor"></a>covtracer</h1></div>

<p>Tools for contextualizing tests, built using <code>covr</code> test traces. This package provides utilities for linking an assortment of test and package information to paint a more complete picture of how a test was performed.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>Tests &lt;--&gt;<span class="st"> </span>Traced Exprs &lt;--&gt;<span class="st"> </span>Package Code &lt;--&gt;<span class="st"> </span>Package Documentation</span></code></pre></div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>To install, use <code>remotes</code> to install directly from <a href="https://www.github.com/Genentech/covtracer">GitHub</a></p>
<p>Functionality hinges heavily on coverage objects prepared using <code>covr</code> (≥ 3.5.1.9003). To ensure suggested dependency requirements are met, install with <code>dependencies = TRUE</code> (satisfy all dependencies).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># will install covr &gt;= v3.5.1.9003 for examples</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"Genentech/covtracer"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="motivation" class="section level2">
<h2 class="hasAnchor">
<a href="#motivation" class="anchor"></a>Motivation</h2>
<p>Tests are not black boxes. When it comes to verifying behaviors of code, we can use observations about the code that is executed by a test to build a more complete picture of exactly what the test does. This is a core part of software validation. By combining information about each test, the tested package code and linking that code to package documentation, we can link documented behaviors to their respective tests.</p>
</div>
<div id="getting-started" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-started" class="anchor"></a>Getting Started</h2>
<p>Test traces are connected to evaluated code using <code>covr</code> (≥ 3.5.1.9003). Likewise, a new option flag (<code>covr.record_tests</code>) must be set in order to record tests alongside the coverage traces. Finally, the package to evaluate must be installed with source references in order to map all the components together.</p>
<p>That’s a lot to configure, but if you’re in a position where this test data is valuable hopefully it’s worth the setup.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">covtracer</span><span class="op">)</span>

<span class="co"># additional demo packages</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://withr.r-lib.org">withr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://covr.r-lib.org">covr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org">remotes</a></span><span class="op">)</span>

<span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_temp_libpaths.html">with_temp_libpaths</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">pkg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"examplepkg"</span>, package <span class="op">=</span> <span class="st">"covtracer"</span><span class="op">)</span>
  <span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_local.html">install_local</a></span><span class="op">(</span>
    <span class="va">pkg</span>, 
    force <span class="op">=</span> <span class="cn">TRUE</span>, 
    quiet <span class="op">=</span> <span class="cn">TRUE</span>, 
    INSTALL_opts <span class="op">=</span> <span class="st">"--with-keep.source"</span>
  <span class="op">)</span>

  <span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>covr.record_tests <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">cov</span> <span class="op">&lt;-</span> <span class="fu">covr</span><span class="fu">::</span><span class="fu"><a href="http://covr.r-lib.org/reference/package_coverage.html">package_coverage</a></span><span class="op">(</span><span class="va">pkg</span><span class="op">)</span>

  <span class="va">ttdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/test_trace_df.html">test_trace_df</a></span><span class="op">(</span><span class="va">cov</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p>There’s a lot of info in the resulting <code>data.frame</code>, but we’ll focus on just the critical piece, showing which tests evaluate code related to which documented behaviors. Below we show how one might map unit tests to evaluated, documented objects.</p>
<blockquote>
<p><strong>Note:</strong> Below we ignore documentation for datasets and S4 class constructors. Although these are defined in the package, they don’t map to testable lines of code because they are constructed when the package is built.</p>
</blockquote>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">traceability_matrix</span> <span class="op">&lt;-</span> <span class="va">ttdf</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">doctype</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"class"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># ignore objects without testable code</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">test_name</span>, <span class="va">file</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">arrange</span><span class="op">(</span><span class="va">file</span><span class="op">)</span>

<span class="va">traceability_matrix</span>
<span class="co">#&gt;                                                    test_name                       file</span>
<span class="co">#&gt; 1         Example R6 Accumulator class constructor is traced             Accumulator.Rd</span>
<span class="co">#&gt; 2            Example R6 Accumulator class methods are traced             Accumulator.Rd</span>
<span class="co">#&gt; 3                         hypotenuse is calculated correctly              hypotenuse.Rd</span>
<span class="co">#&gt; 4  hypotenuse is calculated correctly; with negative lengths              hypotenuse.Rd</span>
<span class="co">#&gt; 5                               S4Example names method works  names-S4Example-method.Rd</span>
<span class="co">#&gt; 6                                                       &lt;NA&gt; names-S4Example2-method.Rd</span>
<span class="co">#&gt; 7          Example R6 Person class public methods are traced                  Person.Rd</span>
<span class="co">#&gt; 8   Example R6 Rando class active field functions are traced                   Rando.Rd</span>
<span class="co">#&gt; 9                                                       &lt;NA&gt;                   Rando.Rd</span>
<span class="co">#&gt; 10                                                      &lt;NA&gt;              rd_sampler.Rd</span>
<span class="co">#&gt; 11              s3_example_func works using default dispatch         s3_example_func.Rd</span>
<span class="co">#&gt; 12                 s3_example_func works using list dispatch         s3_example_func.Rd</span></code></pre></div>
<p>We can quickly see which functions or methods are entirely untested.</p>
</div>
<div id="use-cases" class="section level2">
<h2 class="hasAnchor">
<a href="#use-cases" class="anchor"></a>Use Cases</h2>
<p>The <code>data.frame</code> returned by <code>test_trace_df</code> contains a ton of information, and we can measure a few dimensions of the quality of tests with some relatively straightforward analysis.</p>
<div id="traceability-matrix" class="section level3">
<h3 class="hasAnchor">
<a href="#traceability-matrix" class="anchor"></a>Traceability Matrix</h3>
<p>Perhaps the most immediate use case is to map unit tests to documented behaviors.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ttdf</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">doctype</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"class"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># ignore objects without testable code</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">test_name</span>, <span class="va">file</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">arrange</span><span class="op">(</span><span class="va">file</span><span class="op">)</span>
<span class="co">#&gt;                                                    test_name                       file</span>
<span class="co">#&gt; 1         Example R6 Accumulator class constructor is traced             Accumulator.Rd</span>
<span class="co">#&gt; 2            Example R6 Accumulator class methods are traced             Accumulator.Rd</span>
<span class="co">#&gt; 3                         hypotenuse is calculated correctly              hypotenuse.Rd</span>
<span class="co">#&gt; 4  hypotenuse is calculated correctly; with negative lengths              hypotenuse.Rd</span>
<span class="co">#&gt; 5                               S4Example names method works  names-S4Example-method.Rd</span>
<span class="co">#&gt; 6                                                       &lt;NA&gt; names-S4Example2-method.Rd</span>
<span class="co">#&gt; 7          Example R6 Person class public methods are traced                  Person.Rd</span>
<span class="co">#&gt; 8   Example R6 Rando class active field functions are traced                   Rando.Rd</span>
<span class="co">#&gt; 9                                                       &lt;NA&gt;                   Rando.Rd</span>
<span class="co">#&gt; 10                                                      &lt;NA&gt;              rd_sampler.Rd</span>
<span class="co">#&gt; 11              s3_example_func works using default dispatch         s3_example_func.Rd</span>
<span class="co">#&gt; 12                 s3_example_func works using list dispatch         s3_example_func.Rd</span></code></pre></div>
</div>
<div id="finding-untested-behaviors" class="section level3">
<h3 class="hasAnchor">
<a href="#finding-untested-behaviors" class="anchor"></a>Finding Untested Behaviors</h3>
<p>Once we can map unit testing to documentation, we can filter down to only documentation that is not covered by any test.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ttdf</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">doctype</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"class"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># ignore objects without testable code</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">test_name</span>, <span class="va">count</span>, <span class="va">alias</span>, <span class="va">file</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">arrange</span><span class="op">(</span><span class="va">alias</span><span class="op">)</span>
<span class="co">#&gt;   test_name count                   alias                       file</span>
<span class="co">#&gt; 1      &lt;NA&gt;    NA names,S4Example2-method names-S4Example2-method.Rd</span>
<span class="co">#&gt; 2      &lt;NA&gt;    NA                   Rando                   Rando.Rd</span>
<span class="co">#&gt; 3      &lt;NA&gt;    NA              rd_sampler              rd_sampler.Rd</span></code></pre></div>
</div>
<div id="filter-for-only-directly-tested-behaviors" class="section level3">
<h3 class="hasAnchor">
<a href="#filter-for-only-directly-tested-behaviors" class="anchor"></a>Filter For Only Directly Tested Behaviors</h3>
<p>Some tests evaluate a broad set of functionality by calling functions that themselves call out to internal package functions. This is often perfectly fine, since the mechanisms of calling those internal functions are limited by the surfaced user-facing functions. Nevertheless, whether a function is called directly is a good indication of the “unit”-ness of a unit test. You may consider only the coverage of directly tested functions.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ttdf</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">doctype</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"class"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># ignore objects without testable code</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">direct</span>, <span class="va">alias</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">alias</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarize</span><span class="op">(</span>any_direct_tests <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">direct</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">arrange</span><span class="op">(</span><span class="va">alias</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 10 × 2</span>
<span class="co">#&gt;   alias                   any_direct_tests</span>
<span class="co">#&gt;   &lt;chr&gt;                   &lt;lgl&gt;           </span>
<span class="co">#&gt; 1 Accumulator             TRUE            </span>
<span class="co">#&gt; 2 hypotenuse              TRUE            </span>
<span class="co">#&gt; 3 names,S4Example-method  TRUE            </span>
<span class="co">#&gt; 4 names,S4Example2-method FALSE           </span>
<span class="co">#&gt; 5 Person                  TRUE            </span>
<span class="co">#&gt; # … with 5 more rows</span></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Doug Kelkhoff <br><small class="roles"> Author, maintainer </small>  </li>
<li>Andrew McNeil <br><small class="roles"> Author </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/Genentech/covtracer/actions"><img src="https://github.com/Genentech/covtracer/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Doug Kelkhoff, Andrew McNeil.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
